<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Machine Learning Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="_05b_results_Machine_Learning_files/libs/clipboard/clipboard.min.js"></script>
<script src="_05b_results_Machine_Learning_files/libs/quarto-html/quarto.js"></script>
<script src="_05b_results_Machine_Learning_files/libs/quarto-html/popper.min.js"></script>
<script src="_05b_results_Machine_Learning_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="_05b_results_Machine_Learning_files/libs/quarto-html/anchor.min.js"></script>
<link href="_05b_results_Machine_Learning_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="_05b_results_Machine_Learning_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="_05b_results_Machine_Learning_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="_05b_results_Machine_Learning_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="_05b_results_Machine_Learning_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Machine Learning Model</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="repo"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="machine-learning-using-sklearn" class="level1">
<h1>Machine Learning using SKlearn</h1>
<p>Ultimately, we want to see which variables have the greatest impact on AQI. To do this we must perform a machine learning analysis and create a prediction algorithm.</p>
<p>Starting by looking at the head to see all of our columns. Immediately, we can some missing data, which must be addressed before any machine learning algorithms can be conducted.</p>
<section id="import-the-data" class="level2">
<h2 class="anchored" data-anchor-id="import-the-data">Import the Data</h2>
<div id="cell-check-len" class="cell" data-execution_count="3">
<div id="check-len" class="cell-output cell-output-display" data-execution_count="3">
<pre><code>147039</code></pre>
</div>
</div>
<p>Here we can see all the missing data in each column. There are some very large numbers we must address. The entire dataset is only 147039 rows long. Some columnshave more than half the data missing.</p>
<div id="cell-check-isna" class="cell" data-execution_count="4">
<div id="check-isna" class="cell-output cell-output-display" data-execution_count="4">
<pre><code>yearly_transit_id                            5114
category_id                                  3068
location_id                                     0
date_id                                         0
id                                              0
aqi                                          3068
mean_temperature_fahrenheit                 61895
max_temperature_fahrenheit                  61895
mean_pressure_millibars                     91859
max_pressure_millibars                      91859
mean_humidity_percent_relative_humidity     76818
max_humidity_percent_relative_humidity      76818
mean_wind_knots                             58488
max_wind_knots                              58488
mean_co_ppm                                 32615
max_co_ppm                                  32615
mean_no2_ppb                                27747
max_no2_ppb                                 27747
mean_ozone_ppm                              33163
max_ozone_ppm                               33163
mean_so2_ppb                                49291
max_so2_ppb                                 49291
mean_pm100_micrograms_per_cubic_meter       77281
max_pm100_micrograms_per_cubic_meter        77281
mean_pm25_micrograms_per_cubic_meter        37443
max_pm25_micrograms_per_cubic_meter         37443
mean_lead_micrograms_per_cubic_meter       138816
max_lead_micrograms_per_cubic_meter        138816
date                                            0
state                                           0
st_abbv                                         0
county                                          0
city                                            0
population                                      0
density                                         0
category                                     3068
aqi_range                                    3068
num_busses                                   5114
revenue                                      5844
operating_expense                            5114
passenger_trips                              5114
operating_hours                              5114
passenger_miles                              5114
operating_miles                              5114
dtype: int64</code></pre>
</div>
</div>
<p>The first steps to addressing the missing data will be to drop the columns that will definitely not be needed. This includes the id columns used for joining within the SQL database, as well as the maximum columns as we already have the mean data. We also rename the columns to make it easier to understand and reference.</p>
<p>Now the missing data looks like this, it is a little better, but we can still do so much more.</p>
<div id="cell-check-NaN" class="cell" data-execution_count="6">
<div id="check-nan" class="cell-output cell-output-display" data-execution_count="6">
<pre><code>date                      0
state                     0
county                    0
city                      0
population                0
density                   0
aqi                    3068
category               3068
temp                  61895
pressure              91859
humidity              76818
wind_speed            58488
co                    32615
no2                   27747
o3                    33163
so2                   49291
pm100                 77281
pm25                  37443
lead                 138816
num_busses             5114
revenue                5844
operating_expense      5114
passenger_trips        5114
operating_hours        5114
passenger_miles        5114
operating_miles        5114
dtype: int64</code></pre>
</div>
</div>
<p>We will group data by week. This will take an average count for the entire week for each variable for each city. This will eliminate any missing data that was not captured everyday, but only some days. For example, the pollutants (PM10 and PM2.5) were captured once every three days.</p>
<p>We can also see that the city Virginia Beach has almost no data, so it will be easiest to drop that city.</p>
<p>Next, since we will be measuring and predicting AQI, we will drop all rows missing AQI data.</p>
<p>Missing data is better, but there is still work to do.</p>
<div id="cell-check-NaN-again" class="cell" data-execution_count="10">
<div id="check-nan-again" class="cell-output cell-output-display" data-execution_count="10">
<pre><code>date                     0
state                    0
county                   0
city                     0
population               0
density                  0
aqi                      0
temp                  8199
pressure             12387
humidity             10318
wind_speed            7679
co                    3900
no2                   3250
o3                    3964
so2                   6315
pm100                 4835
pm25                  2055
num_busses             312
revenue                416
operating_expense      312
passenger_trips        312
operating_hours        312
passenger_miles        312
operating_miles        312
dtype: int64</code></pre>
</div>
</div>
<p>The data collected has separate information for the city of New York City. NYC is divided into five borroughs, each within its own county. We will group and average out these values to make NYC have the same amount of datapoints as every other city. This will also address data present in some New York borroughs but not others.</p>
<div id="group-nyc-1-city" class="cell" data-execution_count="11">
<div class="cell-output cell-output-stdout">
<pre><code>          date     state    county           city  population  density  \
0   2015-01-04  New York  Multiple  New York City    18908608  11080.3   
1   2015-01-11  New York  Multiple  New York City    18908608  11080.3   
2   2015-01-18  New York  Multiple  New York City    18908608  11080.3   
3   2015-01-25  New York  Multiple  New York City    18908608  11080.3   
4   2015-02-01  New York  Multiple  New York City    18908608  11080.3   
..         ...       ...       ...            ...         ...      ...   
413 2022-12-04  New York  Multiple  New York City    18908608  11080.3   
414 2022-12-11  New York  Multiple  New York City    18908608  11080.3   
415 2022-12-18  New York  Multiple  New York City    18908608  11080.3   
416 2022-12-25  New York  Multiple  New York City    18908608  11080.3   
417 2023-01-01  New York  Multiple  New York City    18908608  11080.3   

           aqi       temp     pressure   humidity  ...       so2      pm100  \
0    49.450000  38.984375  1015.694425  63.076739  ...  2.011285        NaN   
1    47.514286  23.241072  1019.509891  50.699404  ...  3.337455        NaN   
2    56.000000  29.508929  1017.454363  65.954221  ...  3.034949        NaN   
3    49.800000  34.836310  1008.855166  60.536141  ...  2.267468        NaN   
4    44.342857  25.562500  1010.873006  63.099378  ...  2.640521        NaN   
..         ...        ...          ...        ...  ...       ...        ...   
413  29.657143        NaN          NaN        NaN  ...  0.437256   5.333334   
414  34.742857        NaN          NaN        NaN  ...  0.517050  11.666667   
415  27.600000        NaN          NaN        NaN  ...  0.507095   9.333333   
416  38.000000        NaN          NaN        NaN  ...  0.837313   8.000000   
417  59.566667        NaN          NaN        NaN  ...  1.217373  22.666666   

          pm25  num_busses       revenue  operating_expense  passenger_trips  \
0     7.781642     22195.0  5.427129e+09       1.656689e+10     4.350768e+09   
1     8.393517     22195.0  5.427129e+09       1.656689e+10     4.350768e+09   
2    13.683131     22195.0  5.427129e+09       1.656689e+10     4.350768e+09   
3    10.417719     22195.0  5.427129e+09       1.656689e+10     4.350768e+09   
4     7.102983     22195.0  5.427129e+09       1.656689e+10     4.350768e+09   
..         ...         ...           ...                ...              ...   
413   4.959028      5735.0  8.183201e+08       3.981827e+09     5.032214e+08   
414   7.456925      5735.0  8.183201e+08       3.981827e+09     5.032214e+08   
415   4.837290      5735.0  8.183201e+08       3.981827e+09     5.032214e+08   
416   7.295255      5735.0  8.183201e+08       3.981827e+09     5.032214e+08   
417  17.720097      5735.0  8.183201e+08       3.981827e+09     5.032214e+08   

     operating_hours  passenger_miles  operating_miles  
0         77805045.0     9.676463e+09      577333420.0  
1         77805045.0     9.676463e+09      577333420.0  
2         77805045.0     9.676463e+09      577333420.0  
3         77805045.0     9.676463e+09      577333420.0  
4         77805045.0     9.676463e+09      577333420.0  
..               ...              ...              ...  
413       16852360.0     1.446845e+09      130602200.0  
414       16852360.0     1.446845e+09      130602200.0  
415       16852360.0     1.446845e+09      130602200.0  
416       16852360.0     1.446845e+09      130602200.0  
417       16852360.0     1.446845e+09      130602200.0  

[418 rows x 24 columns]</code></pre>
</div>
</div>
<p>Additionally, Kansas City is located in two states, and thus in two counties. We will do the same thing to contract and standardize the data.</p>
<p>After doing this, we drop the rest of the rows with missing data, leaving us with a total of 17 cities with metropolitan area populations greater than one million.</p>
<div id="cell-count-cities" class="cell" data-execution_count="14">
<div id="count-cities" class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Boston</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Charlotte</td>
<td>418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Cincinnati</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Cleveland</td>
<td>418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Dallas</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Detroit</td>
<td>418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Houston</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Kansas City</td>
<td>241</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Los Angeles</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Memphis</td>
<td>418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>New York City</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Phoenix</td>
<td>418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Pittsburgh</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Portland</td>
<td>418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Raleigh</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>Seattle</td>
<td>418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>St. Louis</td>
<td>418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Washington</td>
<td>418</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To perform a ML prediction algorithm, the predicted variable (AQI) must be discrete. To achieve this, we bin AQI data into discrete groups. Initially, we thought to bin them based on the existing AQI categories, but found that most of the data is grouped in the sub 100 range. Therefore, we expanded the bins, focusing the prediction on outcomes in the double digits. The bins chosen are shown below:</p>
<div id="cell-AQI-bin-ML" class="cell" data-execution_count="15">
<div id="aqi-bin-ml" class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">density</th>
<th data-quarto-table-cell-role="th">aqi</th>
<th data-quarto-table-cell-role="th">temp</th>
<th data-quarto-table-cell-role="th">pressure</th>
<th data-quarto-table-cell-role="th">humidity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">pm100</th>
<th data-quarto-table-cell-role="th">pm25</th>
<th data-quarto-table-cell-role="th">num_busses</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">operating_expense</th>
<th data-quarto-table-cell-role="th">passenger_trips</th>
<th data-quarto-table-cell-role="th">operating_hours</th>
<th data-quarto-table-cell-role="th">passenger_miles</th>
<th data-quarto-table-cell-role="th">operating_miles</th>
<th data-quarto-table-cell-role="th">aqi_discrete</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2015-01-04</td>
<td>Arizona</td>
<td>Maricopa</td>
<td>Phoenix</td>
<td>4064275</td>
<td>1198.9</td>
<td>86.50</td>
<td>41.458333</td>
<td>972.860814</td>
<td>60.739583</td>
<td>...</td>
<td>20.709822</td>
<td>20.505426</td>
<td>729.0</td>
<td>47024975.0</td>
<td>2.256208e+08</td>
<td>55497019.0</td>
<td>2228182.0</td>
<td>2.190928e+08</td>
<td>28371107.0</td>
<td>81-90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-01-04</td>
<td>California</td>
<td>Los Angeles</td>
<td>Los Angeles</td>
<td>11922389</td>
<td>3184.7</td>
<td>118.50</td>
<td>50.281250</td>
<td>1010.666650</td>
<td>58.177084</td>
<td>...</td>
<td>24.954331</td>
<td>21.400000</td>
<td>2259.0</td>
<td>273158938.0</td>
<td>1.056348e+09</td>
<td>367104774.0</td>
<td>7938548.0</td>
<td>1.448619e+09</td>
<td>84041668.0</td>
<td>101-150</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>2015-01-04</td>
<td>District Of Columbia</td>
<td>District of Columbia</td>
<td>Washington</td>
<td>5116378</td>
<td>4235.7</td>
<td>45.25</td>
<td>41.149479</td>
<td>1015.388525</td>
<td>61.075000</td>
<td>...</td>
<td>13.750000</td>
<td>11.088055</td>
<td>1394.0</td>
<td>149657899.0</td>
<td>6.453259e+08</td>
<td>139353079.0</td>
<td>4115200.0</td>
<td>4.293390e+08</td>
<td>39643319.0</td>
<td>41-50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>2015-01-04</td>
<td>Massachusetts</td>
<td>Suffolk</td>
<td>Boston</td>
<td>4328315</td>
<td>5319.0</td>
<td>42.75</td>
<td>33.458332</td>
<td>1018.536500</td>
<td>58.234375</td>
<td>...</td>
<td>6.000000</td>
<td>7.244791</td>
<td>800.0</td>
<td>96572664.0</td>
<td>4.080501e+08</td>
<td>122496729.0</td>
<td>2231562.0</td>
<td>3.162285e+08</td>
<td>22115804.0</td>
<td>41-50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>2015-01-04</td>
<td>Michigan</td>
<td>Wayne</td>
<td>Detroit</td>
<td>3725908</td>
<td>1772.2</td>
<td>49.25</td>
<td>30.203125</td>
<td>994.260400</td>
<td>72.671876</td>
<td>...</td>
<td>18.250000</td>
<td>9.394618</td>
<td>432.0</td>
<td>31303313.0</td>
<td>1.729056e+08</td>
<td>33078462.0</td>
<td>1225079.0</td>
<td>1.696881e+08</td>
<td>17705665.0</td>
<td>41-50</td>
</tr>
</tbody>
</table>

<p>5 rows × 25 columns</p>
</div>
</div>
</div>
<div id="cell-label-bin" class="cell" data-execution_count="16">
<div id="label-bin" class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">density</th>
<th data-quarto-table-cell-role="th">aqi</th>
<th data-quarto-table-cell-role="th">temp</th>
<th data-quarto-table-cell-role="th">pressure</th>
<th data-quarto-table-cell-role="th">humidity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">pm100</th>
<th data-quarto-table-cell-role="th">pm25</th>
<th data-quarto-table-cell-role="th">num_busses</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">operating_expense</th>
<th data-quarto-table-cell-role="th">passenger_trips</th>
<th data-quarto-table-cell-role="th">operating_hours</th>
<th data-quarto-table-cell-role="th">passenger_miles</th>
<th data-quarto-table-cell-role="th">operating_miles</th>
<th data-quarto-table-cell-role="th">aqi_discrete</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2015-01-04</td>
<td>Arizona</td>
<td>Maricopa</td>
<td>Phoenix</td>
<td>4064275</td>
<td>1198.9</td>
<td>86.50</td>
<td>41.458333</td>
<td>972.860814</td>
<td>60.739583</td>
<td>...</td>
<td>20.709822</td>
<td>20.505426</td>
<td>729.0</td>
<td>47024975.0</td>
<td>2.256208e+08</td>
<td>55497019.0</td>
<td>2228182.0</td>
<td>2.190928e+08</td>
<td>28371107.0</td>
<td>81-90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-01-04</td>
<td>California</td>
<td>Los Angeles</td>
<td>Los Angeles</td>
<td>11922389</td>
<td>3184.7</td>
<td>118.50</td>
<td>50.281250</td>
<td>1010.666650</td>
<td>58.177084</td>
<td>...</td>
<td>24.954331</td>
<td>21.400000</td>
<td>2259.0</td>
<td>273158938.0</td>
<td>1.056348e+09</td>
<td>367104774.0</td>
<td>7938548.0</td>
<td>1.448619e+09</td>
<td>84041668.0</td>
<td>101-150</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>2015-01-04</td>
<td>District Of Columbia</td>
<td>District of Columbia</td>
<td>Washington</td>
<td>5116378</td>
<td>4235.7</td>
<td>45.25</td>
<td>41.149479</td>
<td>1015.388525</td>
<td>61.075000</td>
<td>...</td>
<td>13.750000</td>
<td>11.088055</td>
<td>1394.0</td>
<td>149657899.0</td>
<td>6.453259e+08</td>
<td>139353079.0</td>
<td>4115200.0</td>
<td>4.293390e+08</td>
<td>39643319.0</td>
<td>41-50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>2015-01-04</td>
<td>Massachusetts</td>
<td>Suffolk</td>
<td>Boston</td>
<td>4328315</td>
<td>5319.0</td>
<td>42.75</td>
<td>33.458332</td>
<td>1018.536500</td>
<td>58.234375</td>
<td>...</td>
<td>6.000000</td>
<td>7.244791</td>
<td>800.0</td>
<td>96572664.0</td>
<td>4.080501e+08</td>
<td>122496729.0</td>
<td>2231562.0</td>
<td>3.162285e+08</td>
<td>22115804.0</td>
<td>41-50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>2015-01-04</td>
<td>Michigan</td>
<td>Wayne</td>
<td>Detroit</td>
<td>3725908</td>
<td>1772.2</td>
<td>49.25</td>
<td>30.203125</td>
<td>994.260400</td>
<td>72.671876</td>
<td>...</td>
<td>18.250000</td>
<td>9.394618</td>
<td>432.0</td>
<td>31303313.0</td>
<td>1.729056e+08</td>
<td>33078462.0</td>
<td>1225079.0</td>
<td>1.696881e+08</td>
<td>17705665.0</td>
<td>41-50</td>
</tr>
</tbody>
</table>

<p>5 rows × 25 columns</p>
</div>
</div>
</div>
<p>To set up the ML prediction, we must specify the variable being predicted (aqi_discrete, the aqi separated into bins), and the independent prediction variables. We will use a feature selector to select the most accurate predictors to try to optimize the model. Therefore, we initially choose every other variable to be our independent variables.</p>
<p>We must split the data into training and testing datasets. We also define an encoder to transform the discrete predictors into many binary variables for each category.</p>
<p>A transformer is used to quickly transform variables into the necessary form for modeling.</p>
<div id="cell-def-transformer" class="cell" data-execution_count="20">
<div id="def-transformer" class="cell-output cell-output-display theorem definition" data-execution_count="20">
<p><span class="theorem-title"><strong>Definition 1</strong></span> &nbsp;</p>
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[('categories',
                                 OneHotEncoder(handle_unknown='infrequent_if_exist',
                                               min_frequency=5,
                                               sparse_output=False),
                                 ['city', 'year', 'month']),
                                ('scaled_air_quality', StandardScaler(),
                                 ['population', 'density', 'temp', 'pressure',
                                  'humidity', 'wind_speed', 'co', 'no2', 'o3',
                                  'so2', 'pm100', 'pm25', 'num_busses',
                                  'revenue', 'operating_expense',
                                  'passenger_trips', 'operating_hours',
                                  'passenger_miles', 'operating_miles'])],
                  verbose_feature_names_out=False)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox"><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for ColumnTransformer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[('categories',
                                 OneHotEncoder(handle_unknown='infrequent_if_exist',
                                               min_frequency=5,
                                               sparse_output=False),
                                 ['city', 'year', 'month']),
                                ('scaled_air_quality', StandardScaler(),
                                 ['population', 'density', 'temp', 'pressure',
                                  'humidity', 'wind_speed', 'co', 'no2', 'o3',
                                  'so2', 'pm100', 'pm25', 'num_busses',
                                  'revenue', 'operating_expense',
                                  'passenger_trips', 'operating_hours',
                                  'passenger_miles', 'operating_miles'])],
                  verbose_feature_names_out=False)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox"><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">categories</label><div class="sk-toggleable__content fitted"><pre>['city', 'year', 'month']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown='infrequent_if_exist', min_frequency=5,
              sparse_output=False)</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">scaled_air_quality</label><div class="sk-toggleable__content fitted"><pre>['population', 'density', 'temp', 'pressure', 'humidity', 'wind_speed', 'co', 'no2', 'o3', 'so2', 'pm100', 'pm25', 'num_busses', 'revenue', 'operating_expense', 'passenger_trips', 'operating_hours', 'passenger_miles', 'operating_miles']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
</div>
<p>Feature selection is done on the data. From this we are given the following variables: City, Temperature, Humidity, Carbon Monoxide, Nitrogen Dioxide, Ozone, PM10, and PM2.5.</p>
<div id="cell-feature-select" class="cell" data-execution_count="21">
<div id="feature-select" class="cell-output cell-output-display" data-execution_count="21">
<pre><code>Index(['city_Los Angeles', 'city_Phoenix', 'city_Portland', 'temp', 'humidity',
       'co', 'no2', 'o3', 'pm100', 'pm25'],
      dtype='object')</code></pre>
</div>
</div>
<p>Using these selected features, we will run our models.</p>
<p>We will test various models with default parameters to see which is the most accurate at predicting AQI from this dataset. The five models selected are: K nearest neighbors, Tree model, Random Forest model, Logistic Regression, and Naive Bayes.Running the models shows us that the Random Forest model is the most accurate.</p>
<div id="model-select" class="cell" data-execution_count="23">
<div class="cell-output cell-output-stdout">
<pre><code>Model:  KNN
Cohen Kappa Score:  0.27968217934165707
Accuracy:  0.4518236254763201


Model:  Tree
Cohen Kappa Score:  0.38948572170948237
Accuracy:  0.5209580838323353


Model:  Random Forest
Cohen Kappa Score:  0.4811754974115705
Accuracy:  0.6020685900925422


Model:  Logistic
Cohen Kappa Score:  0.31228619929444534
Accuracy:  0.48557430593358736


Model:  naive Bayes
Cohen Kappa Score:  0.003824544630551596
Accuracy:  0.04899292324442025

</code></pre>
</div>
</div>
<p>Running a basic Random Forest model gives us the following cohen kappa score and accuracy. This will serve as the baseline to be compared to.</p>
<div id="cell-def-best-model" class="cell" data-execution_count="24">
<div class="cell-output cell-output-stdout">
<pre><code>cohen kappa score:  0.49484404104036583
accuracy:  0.61295590636908</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_05b_results_Machine_Learning_files/figure-html/def-best-model-output-2.png" id="def-best-model" width="551" height="472" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We will further simplify this with a transformer to be used in a pipeline.</p>
<div id="cell-improve-transformer" class="cell" data-execution_count="25">
<div id="improve-transformer" class="cell-output cell-output-display" data-execution_count="25">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('aqi_transformer',
                 ColumnTransformer(transformers=[('categories',
                                                  OneHotEncoder(handle_unknown='infrequent_if_exist',
                                                                min_frequency=5,
                                                                sparse_output=False),
                                                  ['city']),
                                                 ('scaled_air_quality',
                                                  StandardScaler(),
                                                  ['temp', 'humidity', 'co',
                                                   'no2', 'o3', 'pm100',
                                                   'pm25'])],
                                   verbose_feature_names_out=False)),
                ('RF_model', RandomForestClassifier())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('aqi_transformer',
                 ColumnTransformer(transformers=[('categories',
                                                  OneHotEncoder(handle_unknown='infrequent_if_exist',
                                                                min_frequency=5,
                                                                sparse_output=False),
                                                  ['city']),
                                                 ('scaled_air_quality',
                                                  StandardScaler(),
                                                  ['temp', 'humidity', 'co',
                                                   'no2', 'o3', 'pm100',
                                                   'pm25'])],
                                   verbose_feature_names_out=False)),
                ('RF_model', RandomForestClassifier())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;aqi_transformer: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for aqi_transformer: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[('categories',
                                 OneHotEncoder(handle_unknown='infrequent_if_exist',
                                               min_frequency=5,
                                               sparse_output=False),
                                 ['city']),
                                ('scaled_air_quality', StandardScaler(),
                                 ['temp', 'humidity', 'co', 'no2', 'o3',
                                  'pm100', 'pm25'])],
                  verbose_feature_names_out=False)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">categories</label><div class="sk-toggleable__content fitted"><pre>['city']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox"><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown='infrequent_if_exist', min_frequency=5,
              sparse_output=False)</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox"><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">scaled_air_quality</label><div class="sk-toggleable__content fitted"><pre>['temp', 'humidity', 'co', 'no2', 'o3', 'pm100', 'pm25']</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox"><label for="sk-estimator-id-11" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox"><label for="sk-estimator-id-12" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier()</pre></div> </div></div></div></div></div></div>
</div>
</div>
<p>Next we will optimize hyperparameters to make the model more accurate.</p>
<div id="cell-hyper-parameters-optim" class="cell" data-execution_count="26">
<div id="hyper-parameters-optim" class="cell-output cell-output-display" data-execution_count="26">
<pre><code>{'memory': None,
 'steps': [('aqi_transformer',
   ColumnTransformer(transformers=[('categories',
                                    OneHotEncoder(handle_unknown='infrequent_if_exist',
                                                  min_frequency=5,
                                                  sparse_output=False),
                                    ['city']),
                                   ('scaled_air_quality', StandardScaler(),
                                    ['temp', 'humidity', 'co', 'no2', 'o3',
                                     'pm100', 'pm25'])],
                     verbose_feature_names_out=False)),
  ('RF_model', RandomForestClassifier())],
 'verbose': False,
 'aqi_transformer': ColumnTransformer(transformers=[('categories',
                                  OneHotEncoder(handle_unknown='infrequent_if_exist',
                                                min_frequency=5,
                                                sparse_output=False),
                                  ['city']),
                                 ('scaled_air_quality', StandardScaler(),
                                  ['temp', 'humidity', 'co', 'no2', 'o3',
                                   'pm100', 'pm25'])],
                   verbose_feature_names_out=False),
 'RF_model': RandomForestClassifier(),
 'aqi_transformer__n_jobs': None,
 'aqi_transformer__remainder': 'drop',
 'aqi_transformer__sparse_threshold': 0.3,
 'aqi_transformer__transformer_weights': None,
 'aqi_transformer__transformers': [('categories',
   OneHotEncoder(handle_unknown='infrequent_if_exist', min_frequency=5,
                 sparse_output=False),
   ['city']),
  ('scaled_air_quality',
   StandardScaler(),
   ['temp', 'humidity', 'co', 'no2', 'o3', 'pm100', 'pm25'])],
 'aqi_transformer__verbose': False,
 'aqi_transformer__verbose_feature_names_out': False,
 'aqi_transformer__categories': OneHotEncoder(handle_unknown='infrequent_if_exist', min_frequency=5,
               sparse_output=False),
 'aqi_transformer__scaled_air_quality': StandardScaler(),
 'aqi_transformer__categories__categories': 'auto',
 'aqi_transformer__categories__drop': None,
 'aqi_transformer__categories__dtype': numpy.float64,
 'aqi_transformer__categories__feature_name_combiner': 'concat',
 'aqi_transformer__categories__handle_unknown': 'infrequent_if_exist',
 'aqi_transformer__categories__max_categories': None,
 'aqi_transformer__categories__min_frequency': 5,
 'aqi_transformer__categories__sparse_output': False,
 'aqi_transformer__scaled_air_quality__copy': True,
 'aqi_transformer__scaled_air_quality__with_mean': True,
 'aqi_transformer__scaled_air_quality__with_std': True,
 'RF_model__bootstrap': True,
 'RF_model__ccp_alpha': 0.0,
 'RF_model__class_weight': None,
 'RF_model__criterion': 'gini',
 'RF_model__max_depth': None,
 'RF_model__max_features': 'sqrt',
 'RF_model__max_leaf_nodes': None,
 'RF_model__max_samples': None,
 'RF_model__min_impurity_decrease': 0.0,
 'RF_model__min_samples_leaf': 1,
 'RF_model__min_samples_split': 2,
 'RF_model__min_weight_fraction_leaf': 0.0,
 'RF_model__monotonic_cst': None,
 'RF_model__n_estimators': 100,
 'RF_model__n_jobs': None,
 'RF_model__oob_score': False,
 'RF_model__random_state': None,
 'RF_model__verbose': 0,
 'RF_model__warm_start': False}</code></pre>
</div>
</div>
<p>The following parameters are selected, each with a range of possible values. A large 100 iterations are run to find the highest score.</p>
<div id="def-parameters" class="cell theorem definition" data-execution_count="27">
<p><span class="theorem-title"><strong>Definition 2</strong></span> &nbsp;</p>
<div class="cell-output cell-output-stdout">
<pre><code>0.6234119782214156</code></pre>
</div>
</div>
<p>We can see which hyperparameters are selected.</p>
<div id="cell-randsearch-get-params" class="cell" data-execution_count="28">
<div id="randsearch-get-params" class="cell-output cell-output-display" data-execution_count="28">
<pre><code>{'memory': None,
 'steps': [('aqi_transformer',
   ColumnTransformer(transformers=[('categories',
                                    OneHotEncoder(handle_unknown='infrequent_if_exist',
                                                  max_categories=28,
                                                  min_frequency=18,
                                                  sparse_output=False),
                                    ['city']),
                                   ('scaled_air_quality', StandardScaler(),
                                    ['temp', 'humidity', 'co', 'no2', 'o3',
                                     'pm100', 'pm25'])],
                     verbose_feature_names_out=False)),
  ('RF_model',
   RandomForestClassifier(bootstrap=False, max_depth=14, max_features='log2',
                          min_samples_leaf=2, min_samples_split=4,
                          n_estimators=66))],
 'verbose': False,
 'aqi_transformer': ColumnTransformer(transformers=[('categories',
                                  OneHotEncoder(handle_unknown='infrequent_if_exist',
                                                max_categories=28,
                                                min_frequency=18,
                                                sparse_output=False),
                                  ['city']),
                                 ('scaled_air_quality', StandardScaler(),
                                  ['temp', 'humidity', 'co', 'no2', 'o3',
                                   'pm100', 'pm25'])],
                   verbose_feature_names_out=False),
 'RF_model': RandomForestClassifier(bootstrap=False, max_depth=14, max_features='log2',
                        min_samples_leaf=2, min_samples_split=4,
                        n_estimators=66),
 'aqi_transformer__n_jobs': None,
 'aqi_transformer__remainder': 'drop',
 'aqi_transformer__sparse_threshold': 0.3,
 'aqi_transformer__transformer_weights': None,
 'aqi_transformer__transformers': [('categories',
   OneHotEncoder(handle_unknown='infrequent_if_exist', max_categories=28,
                 min_frequency=18, sparse_output=False),
   ['city']),
  ('scaled_air_quality',
   StandardScaler(),
   ['temp', 'humidity', 'co', 'no2', 'o3', 'pm100', 'pm25'])],
 'aqi_transformer__verbose': False,
 'aqi_transformer__verbose_feature_names_out': False,
 'aqi_transformer__categories': OneHotEncoder(handle_unknown='infrequent_if_exist', max_categories=28,
               min_frequency=18, sparse_output=False),
 'aqi_transformer__scaled_air_quality': StandardScaler(),
 'aqi_transformer__categories__categories': 'auto',
 'aqi_transformer__categories__drop': None,
 'aqi_transformer__categories__dtype': numpy.float64,
 'aqi_transformer__categories__feature_name_combiner': 'concat',
 'aqi_transformer__categories__handle_unknown': 'infrequent_if_exist',
 'aqi_transformer__categories__max_categories': 28,
 'aqi_transformer__categories__min_frequency': 18,
 'aqi_transformer__categories__sparse_output': False,
 'aqi_transformer__scaled_air_quality__copy': True,
 'aqi_transformer__scaled_air_quality__with_mean': True,
 'aqi_transformer__scaled_air_quality__with_std': True,
 'RF_model__bootstrap': False,
 'RF_model__ccp_alpha': 0.0,
 'RF_model__class_weight': None,
 'RF_model__criterion': 'gini',
 'RF_model__max_depth': 14,
 'RF_model__max_features': 'log2',
 'RF_model__max_leaf_nodes': None,
 'RF_model__max_samples': None,
 'RF_model__min_impurity_decrease': 0.0,
 'RF_model__min_samples_leaf': 2,
 'RF_model__min_samples_split': 4,
 'RF_model__min_weight_fraction_leaf': 0.0,
 'RF_model__monotonic_cst': None,
 'RF_model__n_estimators': 66,
 'RF_model__n_jobs': None,
 'RF_model__oob_score': False,
 'RF_model__random_state': None,
 'RF_model__verbose': 0,
 'RF_model__warm_start': False}</code></pre>
</div>
</div>
<p>Using these hyperparameters, we reach an accuracy of about 63%.</p>
<div id="cell-predict-X_test" class="cell" data-execution_count="29">
<div class="cell-output cell-output-stdout">
<pre><code>cohen kappa score:  0.521931603333462
accuracy:  0.6363636363636364</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_05b_results_Machine_Learning_files/figure-html/predict-x_test-output-2.png" id="predict-x_test" width="551" height="472" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can use this model for the prediction of AQI, exploring the features that predict it, and use that to generate conclusions for what particles to reduce or systems to increase.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>